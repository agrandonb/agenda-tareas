<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Tareas Diario - Dashboard</title>
  <link rel="stylesheet" href="estilos.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --color-texto: #333;
      --color-fondo: #f9f9fb;
      --color-primario: #4a90e2; /* azul m√°s suave y profesional */
      --color-verde: #c8e6c9;
      --color-verde-texto: #2e7d32;
      --rojo-pastel: #fbeaea;
      --naranjo-pastel: #fff4e6;
      --amarillo-pastel: #fffce6;
      --gris-claro: #f0f0f0;
      --gris-hover: #e0e0e0;
      --color-blanco: #ffffff;
      --color-borde: #ddd;
      --color-borde-hover: #bbb;
      --color-hover-card: #fafafa;
      --color-caja: #fcfcfc;
    }

    * { box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; margin: 0; padding: 20px; background-color: var(--color-fondo); color: var(--color-texto); }

    header.dashboard-header { display: flex; flex-direction: column; align-items: flex-start; margin-bottom: 20px; }
    .dia-semana { text-align:center; font-weight: bold; margin: 10px 0; }

    .contenedor { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .caja { background-color: var(--color-caja); border-radius: 12px; padding: 15px; display: flex; flex-direction: column; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease; cursor: pointer; }
    .caja:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.12); background-color: var(--color-hover-card); }
    .caja h2 { font-size: 1.15em; font-weight: 600; margin-bottom: 10px; color: var(--color-primario); }

    .caja-notas textarea { width: 100%; min-height: 120px; padding: 8px; font-size: 14px; border: 1px solid var(--color-borde); border-radius: 8px; resize: vertical; font-family: inherit; outline: none; transition: border 0.2s, box-shadow 0.2s; }
    .caja-notas textarea:focus { border-color: var(--color-primario); box-shadow: 0 0 6px rgba(74,144,226,0.3); }

    button { background-color: var(--color-primario); color: white; border: none; border-radius: 6px; padding: 8px 14px; margin: 4px; cursor: pointer; transition: background 0.2s ease, transform 0.2s; }
    button:hover { background-color: #357abd; transform: scale(1.03); }
    .botones-opciones { text-align: center; margin: 15px 0; }

    .titulo-calendario, .titulo-historial, .titulo-graficos {
      cursor: pointer;
      background-color: #eaf1fb;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      user-select: none;
      display: flex;
      align-items: center;
      transition: background 0.2s;
    }
    .titulo-calendario.abierto, .titulo-historial.abierto, .titulo-graficos.abierto { background-color: #d0e4fb; }
    .titulo-calendario::before, .titulo-historial::before, .titulo-graficos::before { content: "‚ñ∂"; margin-right: 6px; transition: transform 0.3s ease; }
    .titulo-calendario.abierto::before, .titulo-historial.abierto::before, .titulo-graficos.abierto::before { transform: rotate(90deg); }

    .historial-container { display: flex; flex-direction: column; gap: 8px; }
    .historial-dia { display: flex; align-items: center; gap: 6px; background-color: var(--gris-claro); border-radius: 8px; padding: 4px 8px; font-size: 0.85rem; }
    .historial-tarea.ok::before { content: "‚úÖ "; }
    .historial-tarea.incompleto::before { content: "‚ùå "; }
    .historial-tarea.fuera::before { content: "üèñÔ∏è "; }

    .graficos-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-top: 10px; }
    canvas { flex: 1 1 auto; width: 100%; min-height: 250px; aspect-ratio: 2 / 1; background-color: var(--color-blanco); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }

    input, select { padding: 6px 10px; border-radius: 6px; border: 1px solid var(--color-borde); margin: 4px 0; }
    .fecha-input { display: none; }
    .fecha-input.visible { display: inline-block; }

    /* ================== Calendario filas horizontales ================== */
    .fila-calendario { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    .fila-calendario input, .fila-calendario select { flex: 1 1 auto; }

    #historial, #contenedorCalendario, #contenedorGraficos, #panelConfigGraficos { max-height: 0; opacity: 0; overflow: hidden; transform: translateY(-10px); transition: max-height 0.4s ease, opacity 0.3s ease, transform 0.3s ease; }
    #historial.show, #contenedorCalendario.show, #contenedorGraficos.show, #panelConfigGraficos.show { max-height: 1000px; opacity: 1; transform: translateY(0); overflow-y: auto; }

    @media (max-width: 1200px) { .contenedor { grid-template-columns: repeat(2,1fr); } }
    @media (max-width: 900px) { .contenedor { grid-template-columns: 1fr; } canvas { min-height: 200px; aspect-ratio: 1.5 / 1; } }
    @media (max-width: 600px) { .caja-notas textarea { min-height: 180px; } canvas { aspect-ratio: auto; min-height: 200px; } }
  </style>
</head>
<body>

<header class="dashboard-header">
  <h1>Registro de Tareas Diario</h1>
  <div class="dia-semana" id="diaSemana" aria-live="polite"></div>
</header>
<div id="botonEditarContainer"></div>

<div class="contenedor" id="contenedorTareas"></div>

<section class="caja-notas caja" aria-label="Notas del d√≠a">
  <h2>Notas:</h2>
  <textarea id="notasDia" placeholder="Escribe tus notas aqu√≠..." aria-label="Notas del d√≠a"></textarea>
</section>

<div class="botones-opciones">
  <button onclick="exportarCSV()">Exportar CSV</button>
  <button onclick="limpiarAntiguos()">Limpiar Registros Antiguos</button>
</div>

<section aria-labelledby="tituloCalendario">
  <h2 class="titulo-calendario" id="tituloCalendario" onclick="toggleElemento('tituloCalendario','contenedorCalendario')">üìÖ Calendario</h2>
  <div id="contenedorCalendario" class="caja" role="region" aria-hidden="true">

    <div class="fila-calendario">
      <label for="fechaSeleccion">Selecciona una fecha:</label>
      <input type="date" id="fechaSeleccion" class="fecha-input visible">
      <button id="btnIrFecha">üóìÔ∏è Ir a fecha</button>
    </div>

    <div class="fila-calendario">
      <label for="selectCaja">Selecciona caja:</label>
      <select id="selectCaja"></select>
      <label for="nuevaTareaCalendario">Nueva tarea:</label>
      <input type="text" id="nuevaTareaCalendario" placeholder="Escribe nueva tarea...">
    </div>

    <div class="fila-calendario">
      <button id="btnAddFecha">‚ûï Solo este d√≠a</button>
      <button id="btnAddFija">üìå Fijo este d√≠a de la semana</button>
      <button id="btnAddTodosDias">üìÖ Todos los d√≠as</button>
    </div>
  </div>
</section>

<section aria-labelledby="tituloHistorial">
  <h2 class="titulo-historial" id="tituloHistorial" onclick="toggleElemento('tituloHistorial','historial')">Historial</h2>
  <div class="historial-container caja" id="historial" role="region" aria-hidden="true"></div>
</section>

<section aria-labelledby="tituloGraficos">
  <h2 class="titulo-graficos" id="tituloGraficos" onclick="toggleElemento('tituloGraficos','contenedorGraficos')">üìä Gr√°ficos</h2>
  <button id="btnConfigGraficos" onclick="toggleConfigGraficos()" aria-expanded="false" aria-controls="panelConfigGraficos">‚öôÔ∏è Configuraci√≥n de Gr√°ficos</button>
  <div id="panelConfigGraficos" class="caja" role="region" aria-hidden="true">
    <label for="rangoGraficoCumplimiento">Rango gr√°fico Cumplimiento:</label>
    <select id="rangoGraficoCumplimiento" onchange="actualizarGraficos()">
      <option value="7d">√öltimos 7 d√≠as</option>
      <option value="mes">Mes actual</option>
      <option value="anio">A√±o actual</option>
      <option value="todo">Todo</option>
    </select>
    <label for="tipoGraficoCumplimiento" style="margin-left:10px;">Tipo gr√°fico Cumplimiento:</label>
    <select id="tipoGraficoCumplimiento" onchange="actualizarGraficos()">
      <option value="line">Lineal</option>
      <option value="bar">Barras</option>
    </select>
    <label for="rangoGraficoHoras" style="margin-left:10px;">Rango gr√°fico Horas:</label>
    <select id="rangoGraficoHoras" onchange="actualizarGraficos()">
      <option value="7d">√öltimos 7 d√≠as</option>
      <option value="mes">Mes actual</option>
      <option value="anio">A√±o actual</option>
      <option value="todo">Todo</option>
    </select>
    <label for="tipoGraficoHoras" style="margin-left:10px;">Tipo gr√°fico Horas:</label>
    <select id="tipoGraficoHoras" onchange="actualizarGraficos()">
      <option value="bar">Barras</option>
      <option value="line">Lineal</option>
    </select>
  </div>
  <div id="contenedorGraficos" class="caja" role="region" aria-hidden="true">
    <div class="graficos-container">
      <canvas id="graficoCumplimiento" role="img" aria-label="Gr√°fico de cumplimiento"></canvas>
      <canvas id="graficoHoras" role="img" aria-label="Gr√°fico de horas"></canvas>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
<script>
  function toggleElemento(tituloId, contenedorId) {
    const titulo = document.getElementById(tituloId);
    const cont = document.getElementById(contenedorId);
    const visible = cont.classList.contains("show");
    cont.classList.toggle("show", !visible);
    titulo.classList.toggle("abierto", !visible);
    cont.setAttribute("aria-hidden", visible);
  }

  function toggleConfigGraficos() {
    const panel = document.getElementById("panelConfigGraficos");
    const expanded = panel.classList.toggle("show");
    panel.setAttribute("aria-hidden", !expanded);
    document.getElementById("btnConfigGraficos").setAttribute("aria-expanded", expanded);
  }
</script>
</body>
</html>
